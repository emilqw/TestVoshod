# Анализ метода putMessage в FederalInquiryRequestService

## 1. Описание реализации веб-метода

Метод `putMessage` в классе `FederalInquiryRequestService` предназначен для приема сообщений от ГИАЦ (Главный информационно-аналитический центр) и передачи их в ФЦОД ПС ФСБ (Федеральный центр обработки данных Пограничной службы ФСБ). Метод обрабатывает данные о лицах, находящихся в розыске.

### Основные действия, выполняемые в методе:

1. **Проверка входных параметров**:
   - Проверяется наличие имени файла, сообщения, подписи и сертификата
   - При отсутствии любого из этих параметров выбрасывается соответствующее исключение

2. **Извлечение идентификатора (ident) из сообщения**:
   - Используется утилитный метод `FederalInquiryUtils.findIdentInMessage()` для извлечения идентификатора из XML-сообщения
   - Идентификатор находится в корневом элементе EFO в атрибуте "ident"

3. **Проверка уникальности идентификатора**:
   - Проверяется, не существует ли уже сообщение с таким идентификатором в базе данных
   - Если такое сообщение уже существует, выбрасывается исключение `DuplicateIdentException`

4. **Генерация идентификатора жизненного цикла**:
   - Создается уникальный идентификатор жизненного цикла сообщения с помощью `bpGenerator.getNextLifecycleID()`

5. **Формирование транспортного сообщения**:
   - Создается объект `FrontierSegmentType` и `FederalInquiryRequestType`
   - В сообщение добавляются данные EFO, сертификат и значение подписи
   - Формируется адресный заголовок с идентификатором жизненного цикла и адресом получателя (ФЦОД ПС ФСБ)

6. **Отправка сообщения в транспортную систему**:
   - Сообщение передается в транспортную систему через `transportMessageGenerator.generateAndApplySoapMessage()`
   - Получается уникальный идентификатор сообщения (messageUid)

7. **Сохранение информации в журнале**:
   - Создается объект `PersonUnderInvestigationInfo` для хранения информации о сообщении
   - Заполняются поля: имя файла, размер файла, идентификатор, дата запроса, UID запроса
   - Устанавливается статус "готов к отправке" (`PERSON_UNDERINVESTIGATION_INFO_STATE_SENDREADY`)
   - Информация сохраняется в базе данных через `personUnderInvestigationInfoDAO.persist()`

### Таблицы БД, используемые в методе:
- Таблица для хранения информации о лицах в розыске (соответствует сущности `PersonUnderInvestigationInfo`)
- Таблица классификаторов для статусов сообщений (соответствует сущности `PersonUnderInvestigationInfoState`)

## 2. Входные параметры и возвращаемые данные

### Входные параметры:

1. **filename** (String):
   - Имя файла с данными о лицах, находящихся в розыске
   - Не может быть null или пустым

2. **message** (byte[]):
   - Содержимое файла в формате ЭФО (электронный формат обмена)
   - Содержит XML-данные о лицах в розыске
   - Не может быть null или пустым массивом

3. **signature** (byte[]):
   - Электронная подпись сообщения
   - Не может быть null или пустым массивом

4. **certificate** (byte[]):
   - Сертификат, используемый для подписи сообщения
   - Не может быть null или пустым массивом

### Возвращаемые данные:

Метод имеет тип возвращаемого значения `void`, то есть не возвращает никаких данных.

### Исключения, которые может выбросить метод:

1. **NullFilenameException** - если имя файла не указано
2. **NullMessageException** - если сообщение не указано
3. **NullCertificateException** - если сертификат не указан
4. **NullSignatureException** - если подпись не указана
5. **DuplicateIdentException** - если сообщение с таким идентификатором уже существует
6. **BadMessageException** - если сообщение имеет неверный формат
7. **NullIdentException** - если в сообщении отсутствует идентификатор
8. **Exception** - другие исключения, которые могут возникнуть в процессе обработки
